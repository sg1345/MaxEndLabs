@model MaxEndLabs.ViewModels.ProductDetailsViewModel
@Html.ValidationMessage("ProductVariantId", "", new { @class = "text-danger" })
@Html.ValidationMessage("Quantity", "", new { @class = "text-danger" })
@{
	ViewBag.Title = Model.Name;
}

<div class="row mt-4">
	<div class="col-md-5">
		@if (string.IsNullOrEmpty(Model.MainImageUrl))
		{
			<img src = "~/images/default_product_image.jpg" class="img-fluid rounded"/>
		}
		else
		{
			<img src="@Model.MainImageUrl" class="img-fluid rounded" alt="@Model.Name"/>
		}
	</div>

	<div class="col-md-7">
		<h2>@Model.Name</h2>
		@if (!string.IsNullOrEmpty(Model.Description))
		{
			<p>@Model.Description</p>
		}

		<h4 class="fw-bold">Price: €<span id="productPrice" data-original-price="@Model.Price">@Model.Price</span></h4>
		
		<form asp-controller="ShoppingCart" asp-action="AddToCart" method="post">
			<input type="hidden" name="productSlug" value="@Model.ProductSlug"/>
			<input type="hidden" name="categorySlug" value="@Model.CategorySlug"/>
			<input type="hidden" name="productId" value="@Model.Id"/>

			@if (Model.ProductVariants.Any())
			{
				<div class="mb-3">
					<label for="variantSelect" class="form-label">Options</label>
						<select id="variantSelect" name="ProductVariantId" class="form-select">
						<option value="0">-- Select an Option --</option>
						@foreach (var variant in Model.ProductVariants)
						{
							<option value="@variant.Id" data-price="@variant.Price">
								@variant.VariantName
							</option>
						}
					</select>
				</div>
			}
			
			<div class="mb-3">
				<label for="quantity" class="form-label">Quantity</label>
				<div class="input-group" style="width: 130px;">
					<button class="btn btn-outline-secondary" type="button" onclick="stepDown()">-</button>
					<input type="number" name="Quantity" id="quantity" class="form-control text-center" value="1" min="1" max="99">
					<button class="btn btn-outline-secondary" type="button" onclick="stepUp()">+</button>
				</div>
			</div>

			<div class="mt-4">
				<div class="d-flex gap-2 mt-3">
					<button class="btn btn-primary btn-lg px-5 shadow-sm rounded-pill" onclick="alert('Item added')">
						<i class="bi bi-cart-fill me-2"></i> Order Now
					</button>
				</div>
			</div>
		</form>

			<div class="mt-5 pt-4 border-top">
				@if (User.IsInRole("Admin"))
				{
					<div class="d-flex align-items-center justify-content-between">
						<span class="small text-muted fw-bold text-uppercase" style="letter-spacing: 1px;">
							Admin Portal
						</span>

						<div class="d-flex gap-2">
							<a asp-action="VariantManager" asp-route-productSlug="@Model.ProductSlug"
							   class="btn btn-sm btn-dark px-3 shadow-sm">
								Options
							</a>

							<a asp-action="Edit" asp-route-productSlug="@Model.ProductSlug"
							   class="btn btn-sm btn-outline-dark px-3">
								Edit
							</a>

							<form asp-action="Delete" asp-route-slug="@Model.ProductSlug" method="post" class="d-inline">
								<button type="submit" class="btn btn-sm btn-outline-danger px-3"
								        onclick="return confirm('Delete permanently?')">
									Delete
								</button>
							</form>
						</div>
					</div>
				}
			</div>
		</div>
	</div>


@section Scripts {
	<script>
		const variantSelect = document.getElementById('variantSelect');
		const priceSpan = document.getElementById('productPrice');
		const originalPrice = priceSpan.getAttribute('data-original-price');

		if (variantSelect) {
			variantSelect.addEventListener('change', function() {
				const selectedOption = variantSelect.options[variantSelect.selectedIndex];
				const variantPrice = selectedOption.dataset.price;
				priceSpan.textContent = variantPrice ? variantPrice : originalPrice;
			});
		}

		function stepUp() {
			document.getElementById('quantity').stepUp();
		}
		function stepDown() {
			document.getElementById('quantity').stepDown();
		}
	</script>
}
